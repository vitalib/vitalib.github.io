!function(t){var e={};function n(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(o,s,function(e){return t[e]}.bind(null,s));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){const{aMachine:o}=n(1),[s,i,r,c,a]=[40,38,13,37,39],l=document.getElementById("selector-input");l.addEventListener("keyup",function(t){t.keyCode===r?o.transition("enter"):t.keyCode==i||t.keyCode==s?o.transition("upDownKeys",{keyCode:t.keyCode}):t.keyCode==c||t.keyCode==a?t.preventDefault():o.transition("input",t)}),l.addEventListener("keydown",function(t){t.keyCode!=c&&t.keyCode!=a||t.preventDefault()})},function(t,e,n){const{machine:o,useContext:s,useState:i}=n(2),r=o({id:"selector",initialState:"noProposals",context:{prevInput:"",prevState:"",inputSelectorId:"selector-input",proposalListId:"proposal-list",selectedTowns:"selected-towns",cities:[]},states:{noProposals:{onEntry(t){const[e,n]=s(),o=document.getElementById(e.proposalListId);for(;o.firstChild;)o.removeChild(o.firstChild)},on:{input:{service:t=>{const[e,n]=i(),[o,r]=s(),c=document.getElementById(o.selectedTowns);8==t.keyCode&&!o.prevInput&&c.children.length?(c.removeChild(c.lastChild),n("noProposals")):(r({prevState:e}),n("request"))}},upDownKeys:{target:"noProposals"},enter:{target:"noProposals"}}},request:{onEntry(t){const[e,n]=i(),[o,r]=s(),c=document.getElementById(o.inputSelectorId).value;if(c.length<2)return n("noProposals"),void r({prevInput:c});if(o.prevInput===c)return void n(o.prevState);let a=new URL("https://api.hh.ru/suggests/areas"),l={text:c};a.search=new URLSearchParams(l),window.fetch(a).then(t=>t.json()).then(t=>{const e=t.items.map(t=>t.text);0==e.length?n("noProposals"):(r({cities:e}),n("display"))}).catch(t=>{console.log(t),n("noProposals")}),r({prevInput:c})},on:{input:{target:"noProposals"},upDownKeys:{target:"noProposals"},enter:{target:"noProposals"}}},display:{onEntry(t){const[e,n]=s(),o=document.getElementById(e.proposalListId);for(;o.firstChild;)o.removeChild(o.firstChild);const i=e.cities;for(let t of i){let e=document.createElement("li");e.className="proposal-element",e.appendChild(document.createTextNode(t)),o.appendChild(e);const s=o.firstChild;s.id="highlighted",n({highlighted:s.innerText})}},on:{input:{service:t=>{const[e,n]=i(),[o,r]=s();r({prevState:e}),n("request")}},upDownKeys:{service:t=>{const[e,n]=s(),o=document.getElementById(e.proposalListId);if(o.children.length<2)return;let i;const r=document.getElementById("highlighted");i=38===t.keyCode?r==o.firstChild?o.lastChild:r.previousSibling:r==o.lastChild?o.firstChild:r.nextSibling,r.removeAttribute("id"),i.id="highlighted",n({highlighted:i.innerText})}},enter:{service:t=>{const[e,n]=s(),o=document.getElementById(e.selectedTowns),r=document.createElement("div");r.className="town",r.appendChild(document.createTextNode(e.highlighted)),o.appendChild(r);const[c,a]=i();document.getElementById(e.inputSelectorId).value="",n({prevInput:""}),a("noProposals")}}}}},actions:{}});t.exports={aMachine:r}},function(t,e,n){const{NoSuchEventException:o,NoSuchTargetException:s,NoSuchActionException:i}=n(3),{MachineStack:r}=n(4);class c{constructor(t){this.id=t.id,this.context=t.context,this.currentState=t.initialState,this.states=t.states,this.actions=t.actions}transition(t,e){const n=this.states[this.currentState],s=n.on[t];if(!s)throw new o(`Event ${t} for state`+` ${this.currentState}  doesn't exists`);return Promise.resolve(this).then(()=>{n.hasOwnProperty("onExit")&&this.callActions("onExit",e)}).then(()=>{const t=s.service;if(t)this.callService(t,e);else{let t=this.getTargetState(s);this.setState(t)}return this}).catch(t=>{throw t})}getTargetState(t){if(t.hasOwnProperty("target"))return t.target;throw new s("Target state for machine"+` ${this.id} is not specified.`)}setContext(t){Object.assign(this.context,t)}setState(t){if(!this.states.hasOwnProperty(t))throw new s(`Target state "${t}"`+` for machine ${this.id} is incorrect.`);this.currentState=t,this.states[t].hasOwnProperty("onEntry")&&this.callActions("onEntry")}getActionByItsName(t){if(!this.actions.hasOwnProperty(t))throw new i(`Action "${action}" is unavailable`);return this.actions[t]}callService(t,e){c.machinesStack.push(this),t(e),c.machinesStack.pop()}callActions(t,e){const n=[],o=this.states[this.currentState][t];if("string"==typeof o)n.push(this.getActionByItsName(o));else if("function"==typeof o)n.push(o);else for(let t of o)"function"==typeof t?n.push(t):"string"==typeof t&&n.push(this.getActionByItsName(t));for(let t of n)c.machinesStack.push(this),t(e),c.machinesStack.pop()}}c.machinesStack=new r,t.exports={machine:function(t){return new c(t)},useContext:function(){let t=c.machinesStack.getTopElement();return[t.context,e=>t.setContext(e)]},useState:function(){let t=c.machinesStack.getTopElement();return[t.currentState,e=>t.setState(e)]}}},function(t,e){t.exports={NoSuchEventException:class extends Error{},NoSuchTargetException:class extends Error{},NoSuchActionException:class extends Error{}}},function(t,e){t.exports={MachineStack:class{constructor(){this.stack=[],this.length=0}push(t){this.stack.push(t),this.length++}pop(){if(this.isEmpty())throw new Error("Stack is empty");return this.length--,this.stack.pop()}isEmpty(){return 0===this.length}getTopElement(){if(this.isEmpty())throw new Error("Stack is empty");return this.stack[this.length-1]}}}}]);